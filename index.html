<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Metro Catholic Late Attendance</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .container {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    .logo {
      max-width: 220px;
      margin-bottom: 20px;
    }

    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      text-align: left;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      background-color: #2e86de;
      color: white;
      border: none;
      margin-top: 20px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1b4f72;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .form-section {
      display: none;
      margin-top: 20px;
      text-align: left;
    }

    #status {
      margin-top: 20px;
      font-weight: bold;
      color: green;
      text-align: center;
    }

    #reader {
      width: 100%;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="metro-logo.png" alt="Metro Catholic Logo" class="logo" />
    <h1>Late Attendance Check-In</h1>

    <label>Select your grade group:</label>
    <div class="button-group">
      <button onclick="showForm('prek2')">Pre-K–2</button>
      <button onclick="showForm('3to8')">Grades 3–8</button>
    </div>

    <!-- Pre-K to 2 QR Scanner -->
    <div id="prek2Form" class="form-section">
      <h2>Pre-K–2 Check-In</h2>
      <button onclick="startScanner()">Start QR Scanner</button>
      <div id="reader"></div>
    </div>

    <!-- Grades 3–8 Manual Check-In -->
    <div id="form3to8" class="form-section">
      <h2>Grades 3–8 Check-In</h2>
      <form id="checkinForm">
        <label for="name">Full Name:</label>
        <input type="text" id="name" required />

        <label for="email">Select Your Email:</label>
        <select id="email" required>
          <option value="">-- Select --</option>
        </select>

        <button type="submit">Submit</button>
      </form>
    </div>

    <p id="status"></p>
  </div>

  <script>
    const students = [
      { name: "John Smith", email: "john.smith@metrocatholic.net" },
      { name: "Emily Davis", email: "emily.davis@metrocatholic.net" },
      { name: "Liam Johnson", email: "liam.johnson@metrocatholic.net" },
      { name: "Olivia Brown", email: "olivia.brown@metrocatholic.net" },
      { name: "Ethan Wilson", email: "ethan.wilson@metrocatholic.net" }
    ];

    function showForm(group) {
      document.getElementById("prek2Form").style.display = group === "prek2" ? "block" : "none";
      document.getElementById("form3to8").style.display = group === "3to8" ? "block" : "none";
      document.getElementById("status").innerText = "";
    }

    const nameInput = document.getElementById("name");
    const emailSelect = document.getElementById("email");

    nameInput.addEventListener("input", function () {
      const inputValue = this.value.toLowerCase();
      emailSelect.innerHTML = '<option value="">-- Select --</option>';
      if (!inputValue) return;

      const filtered = students.filter(s => s.name.toLowerCase().includes(inputValue));
      filtered.forEach(student => {
        const option = document.createElement("option");
        option.value = student.email;
        option.textContent = student.email;
        emailSelect.appendChild(option);
      });
    });

    document.getElementById("checkinForm")?.addEventListener("submit", function (e) {
      e.preventDefault();
      const name = nameInput.value.trim();
      const email = emailSelect.value.trim();
      const timestamp = new Date().toISOString();

      console.log("Checked in:", { name, email, timestamp });
      document.getElementById("status").innerText = "Check-in complete!";
    });

    function startScanner() {
      const qrReader = new Html5Qrcode("reader");
      qrReader.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: { width: 250, height: 250 }
        },
        (qrCodeMessage) => {
          const timestamp = new Date().toISOString();
          console.log("Scanned Pre-K–2 code:", qrCodeMessage, timestamp);
          qrReader.stop();
          document.getElementById("reader").innerHTML = "";
          new Audio("https://www.soundjay.com/buttons/sounds/beep-07.mp3").play();
          document.getElementById("status").innerText = "Check-in complete!";
        },
        (errorMessage) => {
          // optional: console.log("QR scan error:", errorMessage);
        }
      ).catch(err => {
        document.getElementById("status").innerText = "Camera access denied or unavailable.";
      });
    }
  </script>
</body>
</html>
